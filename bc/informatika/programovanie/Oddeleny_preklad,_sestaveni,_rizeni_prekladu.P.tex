\subsection{Oddìlenı pøeklad, sestavení, øízení pøekladu}

\subsubsection*{Struktura programu}

Program se skládá z \emph{modulù}:
\begin{pitemize}
	\item Pøekládány samostatnì kompilátorem 
	\item Spojovány linkerem
\end{pitemize}
Modul z pohledu programátora
\begin{pitemize}
	\item Soubor s pøíponou .cpp (.c)
\end{pitemize}
Hlavièkové soubory
\begin{pitemize}
	\item Soubory s pøíponou .h
	\item Deklarují (a nìkdy i definují) identifikátory pouívané ve více modulech
	\item Vkládány do modulù direktivou include
	\begin{pitemize}
		\item Direktivu zpracovává preprocesor èistì textovì
		\item Preprocesor je integrován v kompilátoru jako první fáze pøekladu
	\end{pitemize}
\end{pitemize}
Modul z pohledu kompilátoru
\begin{pitemize}
	\item Samostatná jednotka pøekladu
	\item Vısledek práce preprocesoru
\end{pitemize}

\subsubsection*{Oddìlenı pøeklad}

\par\begin{center}\includegraphics[width=10cm]{informatika/programovanie/obrazky/oddelenypreklad01.png}
\end{center}
\par\begin{center}\includegraphics[width=10cm]{informatika/programovanie/obrazky/oddelenypreklad02.png}\end{center}
Smysl oddìleného pøekladu modulù je urychlení celkového pøekladu -- nepøekládat to, co se od minula nezmìnilo. Oddìlenı pøeklad dnes díky automatizaci makefily (viz níe) a integrovanımi prostøedími není témìø pro programátora vidìt.

...pri tomto slide je vhodné ujasni si, ako funguje statické a dynamické linkovanie (ako, kde a kedy sa opravujú adresy objektov atï.):
\begin{pitemize}
    \item \emph{Statické linkování} \\ Po oddìleném pøekladu jednotlivé object moduly ještì neobsahují pøímo adresy všech funkcí a externích identifikátorù, jen odkazy na nì. Linker se postará o jejich spojení dohromady. Je nutné, aby jména byla unikátní, take u pøetíenıch a virtuálních funkcí, jako je v C++, musí bı jména zpotvoøena tak, aby ukazovala i tøídu, namespace, parametry a jejich typy. To má na starosti compiler a øíká se tomu \emph{name mangling}.
    \item \emph{Dynamické linkování} \\ Nastává po volání operaèního systému -- zavedení dynamické knihovny do pamìti. Jsou dvì monosti jeho provedení, první je právì pøi zavádìní knihovny, kdy se odkazy na všechny funkce (a mezi nimi navzájem) naplní správnımi hodnotami (podle bázové adresy, na kterou se knihovna do pamìti nahraje). Druhá monost je pouití dvou pointerù pøi volání funkcí z knihovny -- to se vytvoøí tabulka skuteènıch adres, na kterou se z knihovny ukazuje. První monost trvá déle pøi zavádìní knihovny, druhá je zase pomalejší pøi provádìní, ale umoòuje kód knihovny beze zmìn sdílet více procesy.
\end{pitemize}


\par\begin{center}\includegraphics[width=10cm]{informatika/programovanie/obrazky/oddelenypreklad03.png}\end{center}

\emph{Linker} je program, kterı prijímá jeden alebo více objektù generovanıch kompilátorem a sloí je v jeden spustitelnı program.

Objektovı kód, nebo objektovı soubor je reprezentace kódu, kterı kompilátor nebo assembler vytvoøí zpracováním zdrojového kódu. Objektové soubory obsahují kompaktní kód, èasto nazıvanı \uv{binárky} :-) Linker se typicky pouívá na vytvoøení spustitelnıho souboru nebo knihovny spojením (slinkováním) objektovıch souborù. Základní èastí objektového souboru je strojovı kód (kód pøimo vykonávanı CPU poèítaèe).

\subsubsection*{Makefile}

Smyslem programu \emph{make} je øízení pøekladu a linkování. Popis závislostí jednotlivıch modulù a hlavièkovıch na sobì je definován v 1 textovém souboru -- \emph{Makefile} (tj. které soubory je nutné mít aktuální/vytvoøené pro pøeklad kterého souboru). Make vdy po zmìnì souboru pøeloí jen to, co na nìm závisí.
Formát souboru make:
\begin{verbatim}
targets: files; 
        commands; #comment; line-begin\
        line contd.;
\end{verbatim}
Targets -- cíle èinností / cílové soubory, mono definovat vic, pøi spuštìní make bez parametrù se bere první; univ. nástroj (nejen pro pøeklad C/C++). Lze definovat i vlastní makra (pøíkazem \texttt{<název makra> = <string>}) a pak je pouívat (\texttt{\$\{makro\}}).
