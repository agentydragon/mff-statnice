\subsection{Rodina protokolù TCP/IP (ARP, IPv4, IPv6, ICMP, UDP, TCP) -- adresace, routing, fragmentace, spolehlivost, flow control, congestion control, NAT}
\begin{center}
\begin{tabular}{|c|c|}
	\hline
	ISO/OSI & TCP/IP \\
	\hline
	\hline
	aplikaèní vrstva & aplikaèní vrstva\\
	prezentaèní vrstva &\\
	relaèní vrstva &\\
	\hline
	transportní vrstva & transportní vrstva \\
	\hline
	síová vrstva & síová vrstva (té IP vrstva) \\
	\hline
	linková vrstva & vrstva síového rozhraní\\
	fyzická vrstva & \\
	\hline
\end{tabular}
\end{center}

Obvyklé oznaèenie je \emph{TCP/IP protocol suite} (súèasou je viac ako 100 protokolov). Architektúra vznikla postupne (v akademickom prostredí, neskôr sa rozšírila aj do komerènej sféry) -- najprv vznikli protokoly, potom vrstvy -- a od vzniku sa toho zmenilo len málo (zmeny sú aditívne). Je to najpouívanejšia sieová technológia (IP over everything, everything over IP). Prístup autorov bol, na rozdiel od ISO/OSI, od jednoduchšieho k zloitejšiemu -- najprv sa vytvárajú jednoduché riešenia, ktoré sa postupne obohacujú. A sa riešenie prakticky overí (2 nezávislé implementácie), vznikne štandard. TCP/IP predpokladá e siete sú typu nespojované, nespo¾ahlivé a best effort. Všetká inteligencia je sústredená do koncovıch uzlov, sie je \uv{hlúpa} ale rıchla.

TCP/IP bol pôvodne urèenı pre ARPAnet -- nemohol ma teda iadnu centrálnu èas a musel by robustnı voèi chybám (nespo¾ahlivé/nespojované prenosy). Dôraz sa kládol aj na "internetworking". Nebolo však poadované zabezpeèenie, mobilita ani kvalita sluieb.

TCP/IP nedefinuje rôzne siete (èo sa hardvérovıch vlastností tıka) a technológie vo vrstve sieového rozhrania -- iba sa snaí nad nimi prevádzkova protokol IP (okrem SLIP a PPP pre dvojbodové spoje). V sieovej vrstve je IP protokol, v transportnej jednotné transportné protokoly (TCP a UDP), v aplikaènej potom jednotné základy aplikácií (email, prenos súborov, remote login...).

\subsubsection*{Adresace, IPv4, IPv6}
Data se v IP síti posílají po blocích nazıvanıch datagramy. Jednotlivé datagramy putují sítí zcela nezávisle, na zaèátku komunikace není potøeba navazovat spojení èi jinak \uv{pøipravovat cestu} datùm, pøestoe spolu tøeba pøíslušné stroje nikdy pøedtím nekomunikovaly.

IP protokol v doruèování datagramù poskytuje nespolehlivou slubu, oznaèuje se také jako best effort – \uv{nejlepší úsilí}; tj. všechny stroje na trase se datagram snaí podle svıch moností poslat blíe k cíli, ale nezaruèují prakticky nic. Datagram vùbec nemusí dorazit, mùe bıt naopak doruèen nìkolikrát a neruèí se ani za poøadí doruèenıch paketù. Pokud aplikace potøebuje spolehlivost, je potøeba ji implementovat v jiné vrstvì síové architektury, typicky protokoly bezprostøednì nad IP (viz TCP).

Pokud by sí èasto ztrácela pakety, mìnila jejich poøadí nebo je poškozovala, vıkon sítì pozorovanı uivatelem by byl malı. Na druhou stranu pøíleitostná chyba nemívá pozorovatelnı efekt, navíc se obvykle pouívá vyšší vrstva, která ji automaticky opraví.

V \textbf{IPv4} je \emph{adresou} 32bitové èíslo, zapisované po jednotlivıch bajtech, oddìlenıch teèkami. Takovıch èísel existuje celkem $2^{32}$. Urèitá èást adres je ovšem rezervována pro vnitøní potøeby protokolu a nemohou bıt pøidìleny. Dále pak praktické dùvody vedou k tomu, e adresy je nutno pøidìlovat hierarchicky, take celı adresní prostor není moné vyuít beze zbytku. To vede k tomu, e v souèasnosti je ji znatelnı nedostatek IP adres, kterı øeší rùznımi zpùsoby: dynamickım pøidìlováním (tzn. napø. kadı uivatel dial-up pøipojení dostane doèasnou IP adresu ve chvíli, kdy se pøipojí, ale jakmile se odpojí, je jeho IP adresa pøidìlena nìkomu jinému; pøi pøíštím pøipojení pak mùe tentı uivatel dostat úplnì jinou adresu), pøekladem adres (NAT) a podobnì. Ke správì tohoto pøidìlování slouí specializované síové protokoly, jako napø. DHCP.

Pôvodnı koncept adries poèítal so štruktúrou adresy IPv4 v tvare \emph{sie:poèítaè}, kde bolo delenie èastí pevne dané. Neskôr sa to ale ukázalo ako príliš hrubé delenie a lokálna èas adresy (v rámci jednej podsiete) moe mä dnes promenlivú dåku. Obecne platí, e medzi adresami v rovnakej podsieti (majú rovnakú sieovú èas) je moné dopravova dáta priamo -- dotyèní úèastníci sú prepojení jednım ethernetom alebo inou lokálnou sieou. V opaènom prípade sa dáta dopravujú \emph{smerovaèmi/routermi}. Hranicu v adrese medzi adresou siete a poèítaèa urèuje dnes maska podsiete. Jedná sa o 32 bitovú hodnotu, ktorá obsahuje jednotky tam, kde je v adrese urèená sie.

\textbf{Adresovanie sietí} bolo v prvopoèiatkoch internetu vyriešené staticky -- prvıch 8 bitov adresy urèovalo sie, zvyšok jednotlivé poèítaèe (existova tak mohlo max. 256 sietí). S nástupom lokálnych sietí bolo tento systém potrebné zmeni -- zaviedli sa \emph{triedy IP adries}. Existovalo 5 tried (A(zaèiatok 0, hodnoty prvého bajtu 0-127, maska 255.0.0.0), B(10, 128-191, 255.255.0.0), C(110, 192-223, 255.255.255.0), D(1110, 224-239, urèené na multicast) a E(1111, 240-255, urèené ako rezerva)). Postupom èasu sa ale aj toto rozdelenie ukázalo ako nepruné a bol zavedenı CIDR (Classless Inter-Domain Routing) systém v ktorom je moné hranicu medzi adresou siete a lokálnou èasou adresy umiestni ¾ubovo¾ne (oznaèuje sa potom ako kombinácia prefixu a dåky vo forme 192.168.0.0/24, kde 24 znamená e adresu tvorí prvıch 24 bitov -- jinı zápis je pomocí u zmiòované masky podsítì, tj. 192.168.0.0 s maskou 255.255.255.0).

Medzi adresami existujú niektoré tzv. \textbf{vyhradené adresy}, ktoré majú špeciálny vıznam.
\begin{pitemize}
	\item Adresa s (binárnymi) nulami v èasti urèujúcej poèítaè (192.168.0.\textbf{0} (/24)) znamená \uv{táto sie}, resp. \uv{táto stanica}.
	\item Adresa s jednotkami v èasti urèujúcej poèítaè (192.168.0.\textbf{255} (/24)) znamená broadcast -- všesmerové vysielanie.
	\item Adresy 10.0.0.0 -- 10.255.255.255, 172.16.0.0 -- 172.31.255.255 a 192.168.0.0 -- 192.168.255.255 sa pouívajú na adresovanie internıch sietí -- smerovaèe tieto adresy nesmie smerova ïalej do internetu.
\end{pitemize}

\textbf{IPv6} je trvalejším riešením nedostatku adries -- zatia¾ sa ale rozširuje ve¾mi pozvolna. Adresa v IPv6 má dåku 128 bitov (oproti 32), èo znamená cca. $6 \times 10^{23}$ IP adries na $1 m^2$ zemského povrchu -- umoòuje teda, aby kadé zariadenie na zemi malo vlastnú jednoznaènú adresu. Adresa IPv6 sa zapisuje ako osem skupín po štyroch hexadecimálnych èíslach (napr. 2001:0718:1c01:0016:0214:22ff:fec9:0ca5) -- prièom úvodné nuly v èíslach je moné vynecha. Ak po sebe nasleduje nieko¾ko nulovıch skupín, je moné poui len znaky :: -- napr. ::1 miesto 0000:0000:.......:0001. Toto je moné poui len raz v zápise adresy. RFC 4291 zavádza 3 typy adries:
\begin{pitemize}
	\item \textbf{inidividuálne / unicast} -- identifikujú práve jedno rozhranie
	\item \textbf{skupinové / multicast} -- urèuje skupinu zariadení, ktorım sa má správa dopravi
	\item \textbf{vıberové / anycast} -- urèuje tie skupinu zariadení, dáta sa však doruèia len jednému z èlenov (najblišiemu)
\end{pitemize}
IPv6 neobsahuje všesmìrové (broadcast) adresy. Byly nahrazeny obecnìjším modelem skupinovıch adres a pro potøeby doruèení dat všem zaøízením pøipojenım k urèité síti slouí speciální skupinové adresy (napø. ff02::1 oznaèuje všechny uzly na dané lince).

IPv6 zavádí také koncepci dosahu (scope) adres. Adresa je jednoznaèná vdy jen v rámci svého dosahu. Nejèastìjší dosah je pochopitelnì globální, kdy adresa je jednoznaèná v celém Internetu. Kromì toho se èasto pouívá dosah linkovı, definující jednoznaènou adresu v rámci jedné linky (lokální sítì, napø. Ethernetu). Propracovanou strukturu dosahù mají skupinové adresy (viz níe).

Adresní prostor je rozdìlen následovnì:
\begin{center}
\begin{tabular}{|l|l|}
	\hline
	prefix & vıznam \\
	\hline
	\hline
	::/128 & neurèená \\
	::1/128 & smyèka (loopback) \\
	ff00::/8 & skupinové \\
	fe80::/10 & individuální lokální linkové \\
	ostatní & individuální globální \\
	\hline
\end{tabular}
\end{center}

Vıbìrové adresy nemají rezervovánu svou vlastní èást adresního prostoru. Jsou promíchány s individuálními a je otázkou lokální konfigurace, aby uzel poznal, zda se jedná o individuální èi vıbìrovou adresu.

Strukturu globálních individuálních IPv6 adres definuje RFC 3587. Je velmi jednoduchá a de facto odpovídá (a na rozmìry jednotlivıch èástí) vıše uvedené struktuøe IPv4 adresy.

\begin{center}
\begin{tabular}{|l|l|l|}
	\hline
	n bitù & 64-n bitù & 64 bitù \\
	globální smìrovací prefix & adresa podsítì & adresa rozhraní \\
	\hline
\end{tabular}
\end{center}

Globální smìrovací prefix je de facto toté co adresa sítì, následuje adresa podsítì a poèítaèe (pøesnìji síového rozhraní). V praxi je adresa podsítì a na vıjimky 16bitová a globální prefix 48bitovı. Ten je pak pøidìlován obvyklou hierarchií, její stávající pravidla jsou:
\begin{pitemize}
    \item první dva bajty obsahují hodnotu 2001 (psáno v šestnáctkové soustavì)
    \item další dva bajty pøidìluje regionální registrátor (RIR)
    \item další dva bajty pøidìluje lokální registrátor (LIR)
\end{pitemize}

Reálná struktura globální individuální adresy tedy vypadá následovnì:

\begin{center}
\begin{tabular}{|l|l|l|l|l|}
	\hline
	16 bitù & 16 bitù & 16 bitù & 16 bitù & 64 bitù \\
	2001 & pøidìluje RIR &pøidìluje LIR &adresa podsítì & adresa rozhraní \\
	\hline
\end{tabular}
\end{center}
Adresa rozhraní by pak mìla obsahovat modifikovanı EUI-64 identifikátor. Ten získáte z MAC adresy jednoduchım postupem: invertuje se druhı bit MAC adresy a doprostøed se vloí dva bajty obsahující hodnotu fffe. Z ethernetové adresy 00:14:22:c9:0c:a5 tak vznikne identifikátor 0214:22ff:fec9:0ca5.

Adresy zaèínajúce hodnotou ff sú tzv. "skupinové adresy" -- štyri nasledujúce bity v nej obsahujú príznaky, ïalšie štyri potom dosah (napr. interface-local, link-local, admin-local, site-local, organization-local, global...)

IPv6 ïalej podporuje QoS a bezpeènos (IPsec).

\subsubsection*{Routing} 
Pojmem \textbf{smìrování} (routing, routování) je oznaèováno hledání cest v poèítaèovıch sítích. Jeho úkolem je dopravit datovı paket urèenému adresátovi, pokud mono co nejefektivnìjší cestou. Síová infrastruktura mezi odesílatelem a adresátem paketu mùe bıt velmi sloitá. Smìrování se proto zpravidla nezabıvá celou cestou paketu, ale øeší vdy jen jeden krok – komu data pøedat jako dalšímu (tzv. \uv{distribuované smìrování}). Ten pak rozhoduje, co s paketem udìlat dál.

V prípade, e je cie¾ová stanica packetu v rovnakej sieti ako je odosielate¾, o doruèenie sa postará linková vrstva. V opaènom prípade musí odosielate¾ urèi najvhodnejší odchodzí smer a posla datagram smerovaèu vo zvolenom smere.

Základní datovou strukturou pro smìrování je smìrovací tabulka (routing table). Pøedstavuje vlastnì onu sadu ukazatelù, podle kterıch se rozhoduje, co udìlat s kterım paketem. Smìrovací tabulka je sloena ze záznamù obsahujících:
\begin{pitemize}
	\item cílovou adresu, které se dotyènı záznam tıká. Mùe se jednat o adresu individuálního poèítaèe, èastìji však je cíl definován prefixem, tedy zaèátkem adresy. Prefix mívá podobu 147.230.0.0/16. Hodnota pøed lomítkem je adresa cíle, hodnota za lomítkem pak urèuje poèet vıznamnıch bitù adresy. Uvedenému prefixu tedy vyhovuje kadá adresa, která má v poèáteèních 16 bitech (èili prvních dvou bajtech) hodnotu 147.230.
    \item akci urèující, co provést s datagramy, jejich adresa vyhovuje prefixu. Akce mohou bıt dvou typù: doruèit pøímo adresátovi (pokud je dotyènı stroj s adresátem pøímo spojen) nebo pøedat nìkterému ze sousedù (jestlie je adresát vzdálen).
\end{pitemize}

Smìrovací rozhodnutí pak probíhá samostatnì pro kadı procházející datagram. Vezme se jeho cílová adresa a porovná se smìrovací tabulkou následovnì:
\begin{pitemize}
	\item Z tabulky se vyberou všechny vyhovující záznamy (jejich prefix vyhovuje cílové adrese datagramu).
	\item Z vybranıch záznamù se pouije ten s nejdelším prefixem. Toto pravidlo vyjadøuje pøirozenı princip, e konkrétnìjší záznamy (jejich prefix je delší, tedy pøesnìjší; specielním pøípadem je \emph{host-specific route}) mají pøednost pøed obecnìjšími (co mùe bıt napø. i \emph{default route}; ps: \emph{agregace}).
\end{pitemize}

Zajímavou otázkou je, jak vznikne a jak je udrována smìrovací tabulka. Tento proces mají obecnì na starosti smìrovací algoritmy. Kdy jsou pak pro urèitı algoritmus definována pøesná pravidla komunikace a formáty zpráv nesoucích smìrovací informace, vznikne smìrovací protokol (routing protocol). Smìrovací algoritmy mùeme rozdìlit do dvou základních skupin: na statické a dynamické. Èasto se také mluví o statickém a dynamickém smìrování, které je dùsledkem èinnosti pøíslušnıch protokolù.

Pøi \textbf{statickém (té neadaptivním) smìrování} se smìrovací tabulka nijak nemìní. Je dána konfigurací poèítaèe a pøípadné zmìny je tøeba v ní provést ruènì. Tato varianta vypadá jako nepøíliš atraktivní, ve skuteènosti ale drtivá vìtšina zaøízení v Internetu smìruje staticky.

\textbf{Dynamické (adaptivní) smìrování} prùbìnì reaguje na zmìny v síové topologii a pøizpùsobuje jim smìrovací tabulky. Na vytváranie tabuliek existuje nieko¾ko algoritmov -- routovacích protokolov (vector-distance/link-state) -- RIP, BGP, OSPF.

\medskip
\begin{obecne}{Distribuované smìrování}
V distribuovaném smìrování mùe vıpoèet cesty (smìru pøedání paketu) provádìt buï kadı uzel nezávisle, nebo mohou uzly kooperovat (distribuovanı vıpoèet). Rozlišuje se také èetnost aktualizace informací. Dva základní algoritmy distribuovaného smìrování jsou:
\begin{pitemize}
    \item \emph{vector distance} -- kadı uzel si udruje tabulku vzdáleností, pøímí sousedé si vymìòují informace o cestách ke všem uzlùm, tj. jde o distribuovanı vıpoèet, pøenáší se dost informací. Trpí problémem \uv{count-to-infinity} -- tj. kdy 1 uzel pøestane existovat, postupnì si jeho sousedé mezi sebou pøehazují vzdálenost, postupnì o 1 zvìtšovanou (do nekoneèna). Øeší se pomocí technik \uv{split horizon} (neinzeruj vzdálenost zpìt) a \uv{poisoned reverse} (inzeruj zpìt nekoneèno), nìkde ale pøesto selhává.
    \item \emph{link state} -- kadı uzel hledá zmìny svıch sousedù a pokud k nìjaké dojde, pošle floodem informaci do celé sítì. Vıpoèet vzdáleností dìlá kadı uzel sám.
\end{pitemize}
Tyto algoritmy se pouívají u nìkterıch známıch smìrovacích protokolù:
\begin{pitemize}
    \item \emph{RIP} (Routing Information Protocol) -- protokol z BSD Unixu, typu vector distance. Poèítá s max. 16 pøeskoky, zmìny se updatují 2x za minutu. Informace ve smìrovací tabulce mùe zahrnovat max. 25 sítí, pouívá split horizon \& poisoned reverse. Hodí se ale jen pro malé sítì.
    \item \emph{OSPF} (Open Shortest Path First) -- jde o protokol typu link state, uzly si poèítají vzdálenosti do všech sítí Dijkstrovım algoritmem. Pro zjišování zmìn se posílají pakety "HELLO" a "ECHO". Má lepší škálovatelnost, hodí se pro vìtší sítì.
\end{pitemize}
\end{obecne}

\begin{obecne}{Hierarchické smìrování, autonomní systémy}
Hierarchické smìrování znamená rozdìlení sítì do oblastí (\emph{areas}) a smìrování mezi nimi jen pøes vstupní body. Je vhodné pro velké, sloitì propojené nebo rùznım zpùsobem spravované sítì. Nad oblastmi se vytvoøí propojení -- \emph{backbone area} (páteøní systém), pøes které se smìrování mezi oblastmi provádí. Celému tomuto (areas + backbone area) se øíká \emph{autonomní systém}. Detailní smìrovací informace neopouštìjí jednotlivé oblasti. 

Pro smìrování v rámci jedné oblasti i mezi oblastmi v rámci jednoho autonomního systému slouí jeden z tzv. \emph{interior gateway protocol}s, mùe bıt pouit napø. OSPF nebo RIP, pøípadnì další jako IGRP (interior gateway routing protocol, typu vector distance) nebo EIGRP (enhaced IGRP, hybrid mezi vector distance a link state). Mezi jednotlivımi autonomními systémy (pøes AS boundary routers) se smìruje pomocí \emph{exterior gateway protocolu}, jedním z nich je napø. \emph{Border Gateway Protocol} (BGP).

Díky existenci autonomních systémù jde napø. pøi peeringu stanovit, kterı provoz pùjde pøes peering a kterı vıše po upstreamu do páteøních sítí.
\end{obecne}


\subsubsection*{Fragmentace}

\textbf{Maximum transmission unit} (MTU) je maximální velikost paketu, kterı je moné pøenést z jednoho síového zaøízení na druhé. Obvyklá hodnota MTU v pøípadì Ethernetu je cca 1500 bajtù, nicménì mezi nìkterımi místy poèítaèové sítì (spojenıch napøíklad modemem nebo sériovou linkou) mùe bıt maximální délka pøeneseného paketu niší. Hodnotu MTU lze zjistit prostøednictvím protokolu ICMP. Pøi posílání paketù pøes nìkolik síovıch zaøízení je samozøejmì dùleité nalézt nejmenší MTU na dané cestì. Hodnota MTU je omezena zdola na 576 bajtù.

U pøenosového protokolu TCP je pøi smìrování paketu do pøenosového kanálu s niším MTU ne je délka paketu, provedena \textbf{fragmentace paketu}. U protokolu UDP není fragmentace paketu podporována a paket je v takovém pøípadì zahozen.

 Pokud dorazí na smìrovaè paket o velikosti vìtší, ne kterou je pøenosová trasa schopna pøenést (napø. pøi pøechodu z Token Ringu pouívajícího 4 kByte pakety na Ethernet pouívajícího maximálnì 1,5 kByte pakety), musí smìrovaè zajistit tzv. fragmentaci, neboli rozebrání paketu na menší èásti a cílovı uzel musí zajistit opìtovné sloení, neboli defragmentaci.

Fragmenty procházejí pøes sí jako samostatné datagramy. Aby byl koncovı uzel schopen fragmenty sloit do originálního datagramu, musí bıt fragmenty pøíslušnì oznaèeny. Toto oznaèování se provádí v pøíslušnıch polích IP hlavièky.

Pokud nesmí bıt datagram fragmentován, je oznaèen v pøíslušném místì IP hlavièky pøíznakem \uv{Don`t Fragment}. Jestlie takto oznaèenı paket dorazí na smìrovaè, kterı by jej mìl poslat prostøedím s niším MTU a tudí je nutnost provést fragmentaci, provede smìrovaè jeho zrušení a informuje odesílatele chybovou zprávou ICMP. 

Aby byl cílovı uzel schopen sloit originální datagram, musí mít dostateènı buffer do nìho jsou jednotlivé fragmenty ukládány na pøíslušnou pozici danou offsetem. Sloení je dokonèeno v okamiku, kdy je vyplnìn celı datagram zaèínající fragmentem s nulovım offsetem (identification a fragmentation offset v hlavièke) a konèící segmentem s pøíznakem \uv{More Data Flag} (resp. More Fragments) nastavenım na False.

V IPv4 je moné fragmentované pakety ïalej deli; naproti tomu v IPv6 musí fragmentáciu zabezpeèi odosielate¾ -- nevyhovujúce pakety sa zahadzujú.


\subsubsection*{Spolehlivost, Flow control, Congestion control}
Keïe TCP/IP funguje nad obecne nespojovanımi a nespo¾ahlivımi médiami, \textbf{spo¾ahlivos} ktorú TCP poskytuje nie je \uv{skutoèná}, ale len \uv{softvérovo emulovaná} -- medzi¾ahlé uzly o spojení niè nevedia, fungujú nespojovane (pre komunikáciu sa pouíva sieová vrstva, transportná \uv{existuje} iba medzi koncovımi uzlami). Je teda nutné ošetri napr. nespo¾ahlivos infraštruktúry (strácanie dát, duplicity -- prièom strati sa môe aj iados o vytvorenie pripojenia, potvrdenie...) a reboot uzlov (uzol stratí históriu, je potrebné ošetri existujúce spojenia...).

Pouíva sa celá rada techník, kde základom je kontinuálne potvrdzovanie: príjemca posiela kladné potvrdenia; odosielate¾ po kadom odoslaní spúša èasovaè a ak mu do vypršania nepríde potvrdenie, posiela dáta znovu.  Potvrdzovanie nie je samostatné ale vkladá sa do paketov cestujúcich opaènım smerom -- \emph{piggybacking}.

TCP priebene kontroluje \uv{dobu obrátky} a vyhodnocuje váenı priemer a rozptyl dôb obrátky. Èakaciu dobu (na potvrdenie) potom vypoèítava ako funkciu tohto váeného priemeru a rozptylu. Vıslednı efekt je potom ten, e èakacia doba je tesne nad strednou dobou obrátky. V prípade konštantnej doby obrátky sa èakacia doba pribliuje strednej dobe obrátky; ak kolíše, èakacia doba sa zväèšuje.

Dáta v TCP sa príjímajú/posielajú po jednotlivıch byteoch -- interne sa však bufferujú a posielajú a po naplnení buffera (prièom aplikácia si môe vyiada okamité odoslanie -- operácia PUSH). TCP si potrebuje oznaèova jednotlivé byty v rámci prúdu (keïe nepracuje s blokmi) -- napr. kvôli potvrdzovaniu; pouíva sa na to 32-bitová pozícia v bytovom prúde (zaèína sa od náhodne zvoleného èísla).

TCP sa snaí \textbf{riadi tok dát} -- aby odosielate¾ nezahlcoval príjemcu a kvôli tomu nedochádzalo k stráte dát. Podstata riešenia je tzv. \emph{metóda okienka}. Okienko udáva ve¾kos vo¾nıch bufferov na strane prijímajúceho a odosielate¾ môe posiela dáta a do \uv{zaplnenia} okienka. Príjemca spolu s kadım potvrdením posiela aj svoju ponuku -- údaj o ve¾kosti okienka (window advertisment)., ktorı hovorí ko¾ko ešte dát je schopnı prija (naviac k práve potvrdenım). Znovu -- pouíva sa metóda kontinuálneho potvrïovania.

Väèšina strát prenášanıch dát ide skôr na vrub zahlteniu ako chybám HW a transportné protokoly môu nevhodnım chovaním zhoršova dôsledky. TCP kadú stratu dát chápe ako dôsledok zahltenia -- nasadzuje \textbf{opatrenia proti zahlteniu} (congestion control). Po stráte paketu ho pošle znovu ale neposiela ïalšie a èaká na potvrdenie (tj. prechod z kontinuálneho potvrdzovania na jednotlivé $\Rightarrow$ vysiela menej dát ako mu umoòuje okienko). Ak príde potvrdenie vèas, zdvojnásobí mnostvo odosielanıch dát -- a tak pokraèuje kım nenarazí na aktuálnu ve¾kosti okienka (postupne sa tak vracia na kontinuálne potvrdzovanie).

Dôleitou vlastnosou je aj korektné chovanie pri naväzovaní a rušení spojenia (v prostredí, kde môe dôjs k spomaleniu, strate, duplicite...) -- pouíva sa tzv. 3-fázovı handshake. Vytvorenie spojenia prebieha nasledovne:
\begin{enumerate}
	\item Klient pošle serveru SYN paket (v pakete je nastavenı príznak SYN) spolu s náhodnım \emph{sequence number} (X).
	\item Server tento paket prijme, zaznamená si sequence number (X) a pošle spä paket SYN-ACK. Tento paket obsahuje pole Acknowledgement, ktoré oznaèuje ïalšie èíslo (sequence number), ktoré tento host oèakáva (X+1). Tento host rovno vytvorí spätnú session s vlastnım sekvenènım èíslom (Y).
	\item Klient odpovie so sekvenènım èíslom (X+1) a jednoduchım Acknowledgement èíslom (Y+1) -- èo je sekvenèné èíslo servera+1.
\end{enumerate}
Pak u spojení povaováno za navázané. Rušenie spojenia funguje podobne, posílají se pakety FIN (finish), FIN+ACK a ACK. Pokud více ne nìjakı urèitı poèet pokusù o odeslání (po spoèítanıch time-outech) jednoho z 3-way handshake paketù sele (druhá strana neodešle to, co mìlo následovat), spojení se povauje za pøerušené (i u navazování, i u rušení).

\subsubsection*{NAT}

TODO: pøeloit ty copy \& paste z Wiki

Network address translation (zkrácenì NAT, èesky pøeklad síovıch adres) je funkce síového routeru pro zmìnu IP adres packetù procházejících zaøízením, kdy se zdrojová nebo cílová IP adresa pøevádí mezi rùznımi rozsahy. Nejbìnìjší formou je tzv. maškaráda (maskování), kdy router IP adresy z nìjakého rozsahu mìní na svoji IP adresu a naopak -- tím umoòuje, aby poèítaèe ve vnitøní síti (LAN) vystupovaly v Internetu pod jedinou IP adresou. Router si drí po celou dobu spojení v pamìti tabulku pøekladu adres.

Pøeklad síovıch adres je funkce, která umoòuje pøekládání adres. Co znamená, e adresy z lokální sítì pøeloí na jedineènou adresu, která slouí pro vstup do jiné sítì (napø. Internetu), adresu pøekládanou si uloí do tabulky pod náhodnım portem, pøi odpovìdi si v tabulce vyhledá port a pošle pakety na IP adresu pøiøazenou k danému portu. NAT je vlastnì jednoduchım proxy serverem (na sieovej vrstve).

\medskip
\begin{obecne}{Komunikace}
Klient odešle poadavek na komunikace, smìrovaè se podívá do tabulky a zjistí, zdali se jedná o adresu lokální, nebo adresu venkovní. V pøípadì venkovní adresy si do tabulky uloí èíslo náhodného portu, pod kterım bude vysílat a k nìmu si pøiøadí IP adresu. Bìhem pøeposílání \uv{ven} a zmìny adresy v paketu musí NAT také pøepoèítat CRC checksum TCP i IP (aby pakety nebyly zahazovány kvùli špatnému CRC, protoe zmìnìná adresa je jejich souèástí).

Vıhodami NAT sú umonenie pripojenie viacerıch poèítaèov do internetu cez jednu zdie¾anú verejnú IP adresu, a zvıšenie bezpeènosti poèítaèov za NATom (aj keï je to security through obscurity a nie je dobré postavi bezpeènos iba na NATe). Nevıhodami potom sú nefungujúce protokoly (napr. aktívne FTP) -- èo je zrejmé z fungovania NATu.
\end{obecne}

\begin{obecne}{NAT Traversal}
NAT traversal refers to an algorithm for the common problem in TCP/IP networking of establishing connections between hosts in private TCP/IP networks that use NAT devices.

This problem is typically faced by developers of client-to-client networking applications, especially in peer-to-peer and VoIP activities. NAT-T is commonly used by IPsec VPN clients in order to have ESP packets go through NAT.

Many techniques exist, but no technique works in every situation since NAT behavior is not standardized. Many techniques require a public server on a well-known globally-reachable IP address. Some methods use the server only when establishing the connection (such as STUN), while others are based on relaying all the data through it (such as TURN), which adds bandwidth costs and increases latency, detrimental to conversational VoIP applications.
\end{obecne}

\begin{obecne}{Druhy uspoøádání NATu}
\begin{pitemize}
\item \emph{Static NAT}: A type of NAT in which a private IP address is mapped to a public IP address, where the public address is always the same IP address (i.e., it has a static address). This allows an internal host, such as a Web server, to have an unregistered (private) IP address and still be reachable over the Internet.

\item \emph{Dynamic NAT}--- A type of NAT in which a private IP address is mapped to a public IP address drawing from a pool of registered (public) IP addresses. Typically, the NAT router in a network will keep a table of registered IP addresses, and when a private IP address requests access to the Internet, the router chooses an IP address from the table that is not at the time being used by another private IP address. Dynamic NAT helps to secure a network as it masks the internal configuration of a private network and makes it difficult for someone outside the network to monitor individual usage patterns. Another advantage of dynamic NAT is that it allows a private network to use private IP addresses that are invalid on the Internet but useful as internal addresses.

\item \emph{PAT} --- PAT (NAT overloading) je další variantou NATu. U této varianty NATu se více inside local adres mapuje na jednu inside global adresu na rùznıch portech. Tedy máme jednu veøejnou adresu a vnitøní sí oadresovanou inside local adresami. 
Pøekladová tabulka je rozšíøena o dvì poloky: inside local port -- port, ze kterého byl paket odeslán a inside global port -- èíslo portu, na kterı je paket odeslanı ze zdrojového portu poèítaèe mapován. Vıhodou je, e se tak pøipojuje více poèítaèù pøes jednu IP adresu.
\end{pitemize}
\end{obecne}


\subsubsection*{ARP}

\textbf{Address Resolution Protocol (ARP)} se v poèítaèovıch sítích s IP protokolem pouívá k získání ethernetové (MAC) adresy sousedního stroje z jeho IP adresy. Pouívá se v situaci, kdy je tøeba odeslat IP datagram na adresu leící ve stejné podsíti jako odesílatel. Data se tedy mají poslat pøímo adresátovi, u nìho však odesílatel zná pouze IP adresu. Pro odeslání prostøednictvím napø. Ethernetu ale potøebuje znát cílovou ethernetovou adresu.

Proto vysílající odešle ARP dotaz (ARP request) obsahující hledanou IP adresu a údaje o sobì (vlastní IP adresu a MAC adresu). Tento dotaz se posílá linkovım broadcastem – na MAC adresu identifikující všechny úèastníky dané lokální sítì (v pøípadì Ethernetu na ff:ff:ff:ff:ff:ff). ARP dotaz nepøekroèí hranice dané podsítì, ale všechna k ní pøipojená zaøízení dotaz obdrí a jako optimalizaèní krok si zapíší údaje o jeho odesílateli (IP adresu a odpovídající MAC adresu) do své ARP cache. Vlastník hledané IP adresy pak odešle tazateli ARP odpovìï (ARP reply) obsahující vlastní IP adresu a MAC adresu. Tu si tazatel zapíše do ARP cache a mùe odeslat datagram.

Informace o MAC adresách odpovídajících jednotlivım IP adresám se ukládají do ARP cache, kde jsou uloeny do vypršení své platnosti. Není tedy tøeba hledat MAC adresu pøed odesláním kadého datagramu – jednou získaná informace se vyuívá opakovanì. V øadì operaèních systémù (Linux, Windows XP) lze obsah ARP cache zobrazit a ovlivòovat pøíkazem arp.

Alternativou pro poèítaè bez ARP protokolu je pouívat tabulku pøiøazení MAC adres IP adresám definovanou jinım zpùsobem, napøíklad pevnì konfigurovanou. Tento pøístup se pouívá pøedevším v prostøedí se zvıšenımi nároky na bezpeènost, protoe v ARP se dá podvádìt – místo skuteèného vlastníka hledané IP adresy mùe odpovìdìt nìkdo jinı a stáhnout tak k sobì jeho data.

ARP je definováno v RFC 826. Pouívá se pouze pro IPv4. Novìjší verze IP protokolu (IPv6) pouívá podobnı mechanismus nazvanı Neighbor Discovery Protocol (NDP, \uv{objevování sousedù}).

Aèkoliv se ARP v praxi pouívá témìø vıhradnì pro pøeklad IP adres na MAC adresy, nebyl pùvodnì vytvoøen pouze pro IP sítì. ARP se mùe pouít pro pøeklad MAC adres mnoha rùznıch protokolù na síové vrstvì. ARP byl také uzpùsoben tak, aby vyhodnocoval jiné typy adres fyzické vrstvy: napøíklad ATMARP se pouívá k vyhodnocení ATM NSAP adres v protokolu Classical IP over ATM.

\subsubsection*{ICMP}

\textbf{ICMP protokol (anglicky Internet Control Message Protocol)} je jeden z jádrovıch protokolù ze sady protokolù internetu. Pouívají ho operaèní systémy poèítaèù v síti pro odesílání chybovıch zpráv -- napøíklad pro oznámení, e poadovaná sluba není dostupná nebo e potøebnı poèítaè nebo router není dosaitelnı.

ICMP se svım úèelem liší od TCP a UDP protokolù tím, e se obvykle nepouívá sítovımi aplikacemi pøímo. Jedinou vıjimkou je nástroj ping, kterı posílá ICMP zprávy \uv{Echo Request} (a oèekává pøíjem zprávy \uv{Echo Response}) aby urèil, zda je cílovı poèítaè dosaitelnı a jak dlouho paketùm trvá, ne se dostanou k cíli a zpìt.

ICMP protokol je souèást sady protokolù internetu definovaná v RFC 792. ICMP zprávy se typicky generují pøi chybách v IP datagramech (specifikováno v RFC 1122) nebo pro diagnostické nebo routovací úèely. Verze ICMP pro IPv4 je známá jako ICMPv4. IPv6 pouívá obdobnı protokol: ICMPv6.

ICMP zprávy se konstruují nad IP vrstvou; obvykle z IP datagramu, kterı ICMP reakci vyvolal. IP vrstva patøiènou ICMP zprávu zapouzdøí novou IP hlavièkou (aby se ICMP zpráva dostala zpìt k pùvodnímu odesílateli) a obvyklım zpùsobem vzniklı datagram odešle. Napøíklad kadı stroj (jako tøeba mezilehlé routery), kterı forwarduje IP datagram, musí v IP hlavièce dekrementovat políèko TTL (\uv{time to live}, \uv{zbıvající doba ivota}) o jednièku. Jestlie TTL klesne na 0 (a datagram není urèen stroji provádìjícímu dekrementaci), router pøijatı paket zahodí a pùvodnímu odesílateli datagramu pošle ICMP zprávu \uv{Time to live exceeded in transit} (\uv{bìhem pøenosu vypršela doba ivota}).

Kadá ICMP zpráva je zapouzdøená pøímo v jediném IP datagramu, a tak (jako u UDP) ICMP nezaruèuje doruèení. Aèkoli ICMP zprávy jsou obsaené ve standardních IP datagramech, ICMP zprávy se zpracovávají odlišnì od normálního zpracování prokolù nad IP. V mnoha pøípadech je nutné prozkoumat obsah ICMP zprávy a doruèit patøiènou chybovou zprávu aplikaci, která vyslala pùvodní IP paket, kterı zpùsobil odeslání ICMP zprávy k pùvodci.

Mnoho bìnì pouívanıch síovıch diagnostickıch utilit je zaloeno na ICMP zprávách. Pøíkaz traceroute je implementován odesíláním UDP datagramù se speciálnì nastavenou ivotností v TTL políèku IP hlavièky a oèekáváním ICMP odezvy \uv{Time to live exceeded in transit} nebo \uv{Destination unreachable}. Pøíbuzná utilita ping je implementována pouitím ICMP zpráv \uv{Echo} a \uv{Echo reply}.

\textbf{Nejpouívanìjší ICMP datagramy}:

\begin{pitemize}
    \item \emph{Echo}: poadavek na odpovìï, kadı prvek v síti pracující na IP vrstvì by na tuto vızvu mìl reagovat. Èasto to z rùznıch dùvodù není dodrováno.
    \item \emph{Echo Reply}: odpovìï na poadavek
    \item \emph{Destination Unreachable}: informace o nedostupnosti cíle, obsahuje další upøesòující informaci
		\begin{pitemize}
			\item Net Unreachable: nedostupná cílová sí, reakce smìrovaèe na poadavek komunikovat se sítí, do které nezná cestu
			\item Host Unreachable: nedostupnı cílovı stroj
			\item Protocol Unreachable: informace o nemonosti pouít vybranı protokol
			\item Port Unreachable: informace o nemonosti pøipojit se na vybranı port
		\end{pitemize}
    \item \emph{Redirect}: pøesmìrování, pouívá se pøedevším pokud ze sítì vede k cíli lepší cesta ne pøes defaultní bránu. Stanice vìtšinou nepouívají smìrovací protokoly a proto jsou informovány touto cestou. Funguje tak, e stanice pošle datagram své, vìtšinou defaultní, bránì, ta jej pøepošle správnım smìrem a zároveò informuje stanici o lepší cestì.
		\begin{pitemize}
			\item Redirect Datagram for the Network: informuje o pøesmìrování datagramù do celé sítì
			\item Redirect Datagram for the Host: informuje o pøesmìrování datagramù pro jedinı stroj
		\end{pitemize}
    \item \emph{Time Exceeded}: vypršel èasovı limit
		\begin{pitemize}
			\item Time to Live exceeded in Transit: bìhem pøenosu došlo ke sníení TTL na 0 ani byl datagram doruèen
			\item Fragment Reassembly Time Exceeded: nepodaøilo se sestavit jednotlivé fragmenty v èasovém limitu(napø pokud dojde ke ztrátì èásti datagramù)
		\end{pitemize}
\end{pitemize}

Ostatní datagramy jsou pouívány spíše vzácnì, nìkdy je pouívání ICMP znemonìno zcela špatnım nastavením firewallu.

\subsubsection*{UDP, TCP}
UDP -- nespo¾ahlivı nespojovanı prenos datagramov... pridáva len porty\\
TCP -- porty+spo¾ahlivı spojovanı prenos streamov... \\
...ïalšie info viï kapitolu o BSD Sockets :-) \\