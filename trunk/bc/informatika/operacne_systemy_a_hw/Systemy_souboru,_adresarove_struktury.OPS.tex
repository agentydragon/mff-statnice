\subsection{Systémy souborù, adresáøové struktury}

\begin{e}{Definice}{0}{soubor}
  \emph{Soubor} je pojmenovaná mnoina souvisejících informací, která leí v
  pomocné pamìti (na disku).\\
  \emph{Soubor} je abstrakce, která umoòuje uloit informaci na disk a pozdìji ji
  pøeèíst. Abstrakce odstiòuje uivatele od podrobností práce s disky.
\end{e}

\begin{obecne}{Soubory}
  \begin{pitemize}
    \item pojmenování souboru (umoòuje uivateli pøístup k jeho datùm;
    pøesná pravidla pojmenování urèuje OS - malá vs. velká písmenka,
    speciální znaky, délka jména, pøípony a jejich vıznam)
    \item atributy souborù (opìt urèuje OS) - jméno, typ, umístìní, velikost, ochrana, èasy, vlastník, \dots
    \item struktura souborù - sekvence bajtù / sekvence záznamù / strom
    \item typy souborù - bìné soubory, adresáøe (systémové soubory vytváøející strukturu souborového systému), speciální soubory (znakové/blokové, soft linky)
    \item pøístup 
    \begin{pitemize}
      \item \textbf{sekvenèní}~-- pohyb pouze vpøed, OS mùe pøednaèítat
      \item \textbf{náhodnı}~-- mono mìnit aktuální pozici
      \item \textbf{pamìovì mapované soubory}~-- pojmenovaná virtuální pamì,
      práce se souborem instrukcemi pro práci s pamìtí, ušetøí se kopírování
      pamìtí; mají i problémy (pøesná velikost souboru, zvìtšování souboru,
      velikost souborù)
    \end{pitemize}
    \item volné místo na disku - bitmapa / spojovı seznam volnıch blokù 
  \end{pitemize}
\end{obecne}

\begin{obecne}{Uloení souborù}
  Soubory se ukládají na disk po blocích
  \begin{pitemize}
    \item souvislá alokace - souvislı sled blokù
    \item spojovaná alokace - blok odkazuje na další
    \item indexová alokace - inode (UNIX) 
  \end{pitemize}
\end{obecne}

\begin{obecne}{Adresáøe}
  \begin{pitemize}
    \item zvláštní typ souboru
    \item operace nad adresáøi - hledání souboru / vypsání adresáøe /
    pøejmenování, vytvoøení, smazání souboru 
    \item koøen, aktuální adresáø, absolutní/relativní cesta
    \item hierarchická struktura 
    \begin{pitemize}
      \item \emph{strom}~-- jednoznaèné pojmenování (cesta)
      \item \emph{DAG}~-- víceznaèné pojmenování, ale nejsou cykly
      \item \emph{obecnı graf}~-- cykly vytváøí problém pøi prohledávání
    \end{pitemize}
    \item implementace adresáøù - záznamy pevné velikosti, spojovı seznam, B-stromy 
  \end{pitemize}
\end{obecne}

\begin{obecne}{Co musí filesystém umìt?}
musí splòovat 3 vìci: \emph{správu souborù} (kde jsou, jak velké), \emph{správu adresáøù} (pøevod jméno $\leftrightarrow$ id) (nìkdy to dìlá jinı prostøedek, dnes vìtš. umí FS sám), \emph{správu volného místa}. nìkdy mohou bıt i další (odolnost proti vıpadkùm) 

Velikost blokù -- blok = nejmenší jednotka pro práci s diskem; disk pracuje s min. 1 sektorem (typicky 512 B) - nìkdy by pak bylo moc blokù $\rightarrow$ OS sdruí nìkolik sektorù lineánì vedle sebe = 1 blok. velikost: velké = rychlejší práce, ale vnitøní fragmentace (prùmìrnı soubor má cca pár KB), malé = malá vnitøní fragmentace, vìtší reie na info o volném místì/ umístìní souboru (zabírá víc blokù!), navíc fragmentace souborù $\rightarrow$ zpomalení. dnes má blok cca 2-4KB.
\end{obecne}

\begin{obecne}{Linky}
  \begin{pitemize}
    \item \textbf{Hard link}~-- Na jedna data souboru se odkazuje z rùznıch poloek v adresáøích (na urovni FS)
    \item \textbf{Soft link}~-- Speciální soubor, kterı obsahuje jméno souboru (na urovni OS)
  \end{pitemize}
\end{obecne}

\begin{obecne}{MBR} 
A master boot record (MBR) is a type of boot sector. It consists of a sequence of 512 bytes located at the first sector of a data storage device such as a hard disk. May be used for one or more of the following:
  \begin{pitemize}
    \item Holding a partition table which describes the partitions of a storage device. In this context the boot sector may also be known as a partition sector.
    \item Bootstrapping an operating system. The BIOS built into a PC-compatible computer loads the MBR from the storage device and passes execution to machine code instructions at the beginning of the MBR.
    \item Uniquely identifying individual disk media, with a 32-bit disk signature, even though it may never be used by the operating system.
  \end{pitemize}
\end{obecne}

\begin{obecne}{FAT} 
  \begin{pitemize}
    \item System souboru FAT rozdeluje disk na dve vyznacne casti - samotnou tabulku FAT (ta je zpravidla ve dvou kopiich) a datovou oblast. Datova oblast je rozdelena na clustery (napriklad po 4096 bajtech) a FAT tabulka ma tolik polozek, kolik ma datova oblast clusteru (1:1).
    \item \textbf{FAT tabulka}~-- obsahuje èislo dalsiho clusteru v øadì + speciální záznamy (oznaèení end of clusterchain, bad cluster, reserved cluster a free cluster)
    \item \textbf{Alokace souboru}~-- spojovaná, kdı blok ukazuje na další pøes FAT tabulku    
    \begin{center}
      \includegraphics[height=5cm]{informatika/operacne_systemy_a_hw/obrazky/FAT16.png}
    \end{center}      
    \subitem - Kdyz je nejaky cluster volny, v prislusne polozce FAT je 0. Tedy 
kdyz chci najit volne misto, tak staci najit libovolnou polozku FAT, 
ktera je 0, odpovidajici cluster pak je volny.    
    \item Adresare i soubory jsou ulozeny stejne. Rozdily mezi adresari a soubory (krom daneho atributu) neexistuji. Z hlediska ulozeni na disku je adresar proste soubor, jehoz obsahem jsou adresarove polozky. Vyjimka viz root adresar. 
    \item \textbf{Root adresáø}~-- V root adresari, i ve vsech ostatnich adresarich, jsou 
proste jen za sebou ulozeny polozky. Kazda polozka obsahuje jmeno 
souboru nebo adresare, ke kteremu se vztahuje, atributy rozlisujici 
napriklad prave adresare od souboru, delku, prvni cluster, atd.
    \subitem - Root directory ma pevnou velikost ve FAT 12/16
    \subitem - Polozky root adresare, ktere nejsou pouzite, jsou oznacene jako prazdne 
(ale porad patri do root adresare, aby velikost zustala konstantni). 
Pridani pak pouzije nekterou prazdnou polozku. Pokud jsou jiz vsechny 
polozky plne, dalsi nelze pridat.
    \item \textbf{Vyhledávání souboru}~--  Postupne ... v root adresari se najde prvni podadresar cesty, v nem se 
najde druhy a tak dale. (tzn. lineární struktura)
    \item Adresarova struktura je ulozena prave v jednotlivych adresarich. 
Napriklad, pokud je na disku soubor \FOO\BAR\SOUBOR.TXT, tak v korenovem 
adresari bude polozka FOO s atributem indikujicim, ze se jedna o adresar 
a s cislem prvniho clusteru adresare FOO, rekneme ze 123. V clusteru 123 
pak budou polozky adresare FOO, mezi nimi bude podobne polozka BAR pro 
adresar BAR a cislem prvniho clusteru adresare BAR, rekneme 456. A v 
clusteru 456 budou polozky adresare BAR, mezi kterymi bude i polozka 
SOUBOR.TXT ...
    \item dnes se ni setkame ještì na flashkách a pamìovıch kartách                
    \item \textbf{nevyhody FAT}: 
    \subitem - velikost souboru max 4 GB  
    \subitem - svazky - FAT32 reálnì okolo 8TB (32kB clustery), nemá ale ochranu proti fragmentaci
    \subitem - práva - None of the various FAT-flavours has facilities for user-based access restrictions.
    \item \url{https://d3s.mff.cuni.cz/pipermail/osy/2005-June/000167.html}
    \item \url{http://en.wikipedia.org/wiki/File\_Allocation\_Table}
\end{obecne}

\begin{obecne}{NTFS} 
  \begin{pitemize}
    \item Zase rozdìluje oddíl na dvì èásti tabulka MFT (jako soubor, ma ale pøiøazenou prázdnou oblast aby se pøi rùstu nefragmentovala) a datovou oblast.
    \item \textbf{Metafiles} - prvních cca 16 souboru jsou tzv. Metafiles, kadı se stará o nìco $\Rightarrow$ flexibilita napø. pri poskozenem povrchu        
    \subitem pøíklady souboru: \$MFT,\$MFTmirr(MFT a zalozni kopie uprostred disku),\$LogFile (zurnalovaci soubor),\$. (root directory),\$Bitmap (bitove pole volneho mista) atd...             
    \item \textbf{urnál} -- Operace s diskem se provadeji jako Transakce, take napø. pokud pri zapisu souboru FS zjisti ze cluster je fyz. vadnı, celou trasakci rollbackuje a pusti ji jinde znovu.
    \item Další vlastnosti ktere ma navic: sifrovani, komprese, hardlinky (soubor je fyz. na disku jednou a ma vic zaznamu v MFT)
    \item \textbf{MFT tabulka} -- obdoba FAT, vsechna metadata o souborech (jmeno,datum,prava) jsou ulozena v MFT - omoznuje pridavat ficury, muze obsahovat primo i male soubory nebo odkaz na clustery (všechny)
    \item Vnitøní struktura adresáøe se realizuje B+Stromem (lexikograficky setrideny) zase pokud je malej zustane v MFT pokud je vetsi je v clusteru a v MFT je jenom koøenová èást B+Stromu.     
    \begin{center}
      \includegraphics[height=5cm]{informatika/operacne_systemy_a_hw/obrazky/ntfs.png}
    \end{center}        
    \item \url{http://pages.cs.wisc.edu/~bart/537/lecturenotes/s26.html}    
    \item \url{http://www.digit-life.com/articles/ntfs/}
    \item \url{http://www.pcguide.com/ref/hdd/file/ntfs/archSector-c.html}
    \item \url{http://cs.wikipedia.org/wiki/NTFS}    
    \item \url{http://ixbtlabs.com/articles/ntfs/}
\end{obecne}

\begin{obecne}{ext2} 
  \begin{pitemize} 
    \item Prostor je u ext2 rozdìlen do blokù, ty jsou rozdìleny do skupin (Block Groups) typicky jeden soubor se drí v jedné skupinì (redukce fragmentace). Kadá skupina obsahuje kopii superbloku (obsahuje kritické informace pro boot systemu) bitmapu blokù, inodes, Inode tabulku a nakonec datové bloky.
    \begin{center}
      \includegraphics[height=4cm]{informatika/operacne_systemy_a_hw/obrazky/ext2.gif}
    \end{center}     
    \item \textbf{inode} -- kadı soubor nebo sloka je reprezentována jako inode (v inode tabulce), obsahuje práva, velikost a hlavnì pointery na datové bloky (12pointerù na pøímı odkaz a další na stromovou strukturu), sloky
obsahují list inodes které obsahují
    \begin{center}
      \includegraphics[height=6cm]{informatika/operacne_systemy_a_hw/obrazky/inode.gif}
    \end{center}           
    \item Proc se porad pouziva - kvùli rychlosti
    \item urnálování zavedeno u ext3              
    \item \url{http://homepage.smc.edu/morgan\_david/cs40/analyze-ext2.htm}    
    \item \url{http://www.science.unitn.it/~fiorella/guidelinux/tlk/node95.html}
    \item \url{http://www.linux-security.cn/ebooks/ulk3-html/0596005652/understandlk-CHP-18.html}
\end{obecne}

\begin{obecne}{Plánování pohybu hlav diskù}
  \begin{pitemize}
    \item FCFS (First-Come, First-Served) - ádné plánování, fronta poadavkù, jeden za druhım
    \item SSTF (Shortest Seek Time First) - krajní ádosti mohou "hladovìt"
    \item LOOK (vıtah), C-LOOK (circular LOOK) - pohyb jen jedním smìrem, na konci otoèka 
  \end{pitemize}
\end{obecne}

\begin{obecne}{RAID (Redundant Array of Inexpensive Disks)}
  \begin{pitemize}
    \item JBOD (Just a Bunch of Disks)
    \item RAID 0~-- striping, ádná redundance
    \item RAID 1~-- mirroring, redundance
    \item RAID 0+1~-- mirroring a striping
    \item RAID 2~-- 7-bitovı paritní Hammingùv kód
    \item RAID 3~-- 1 paritní disk, po bitech na disky
    \item RAID 4~-- 1 paritní disk a striping
    \item RAID 5~-- distribuovaná parita a striping
    \item RAID 6~-- distribuovaná parita -- dvojitá P+Q, striping 
  \end{pitemize}
\end{obecne}

\begin{reportN}{Galamboš} inode\end{reportN}
\begin{reportN}{Galamboš} Konkretni soubory system NTFS - tady jsem popletl jak vlastne pracuje FATka, o NTFS jsem mel tak jako povesechne informace, proste nic moc jsem nevedel, ale zase jsme si popovidali, byly mi vysvetleny me omyly a nakonec oka. 
Jinak je pravda, ze toho chce docela hodne a dopodrobna, ale kdyz clovek rekne, ze proste k tomuhle vic nesehnal a ze podrobnosti proste nevi, pobavi se o tom s Vami a vetsinou se to da dokupy. 
\end{reportN}
\begin{reportN}{Skopal} Zkoušel sám p. Skopal a jeliko jsem se FS uèil jako jednu z prvních otázek, v návalu dalších informací jsem toho mezitím dost zapomnìl. Popsal jsem jeden a pùl strany obecnımi vlastnostmi FS, co to je soubor, adresáø atd. Popsal jsem FAT, NTFS a ext2, a to dost struènì. Obecné vlastnosti ho nezajímaly, hned pøešel k FAT a jejím nevıhodám, otázky byly rychlé a dost podrobné, bylo vidìt, e to se mnou nebude mít jednoduché. Pak mìl otázky na NTFS, co má za spec. soubory, kdee je v systému implementován B-strom atd. K ext2 jsme se nedostali a na jedinou zmínku, a to je alokace souborù (ve FAT lineární struktura, v ext2 strom). Kdy poloil otázku na B-stromy v NTFS a po mojí tìce nejisté odpovìdi prohlásil, e mu to staèí a odešel, bylo mi jasné, e tohle nedopadne dobøe.
\end{reportN}
\begin{reportN}{Yaghob} Konkretni Filesystemy - no jeste pred dvema dny by to byla moje smrt, nastesti sem se na to vcera zameril a nasel si opravdu presne jak funguje FAT, NTFS a ext2. Nakonec z toho byly tri papiry, az jsem na sebe byl pysny U FAT bylo treba napsat, jak se to alokuje, jak vypada ta tabulka, jakou roli ma kor. adresar, jak jsou tam ulozeny adresare, soubory apod. U NTFS jsem popsal vlastnosti ktere to ma navic, jako zurnal, sifrovani a pak rozepsal MFT docela podrobne, zase jak se resi soubory, adresare. Veci jako jak jsou tam ulozeny jednotlivy volume, MBR atd po me nastesti nechtel U ext2 je asi dulezite pochopit jak ten inode funguje, jak je to tam ve skupinach bloku, co je to superblok. Prislo mi, ze hlavni duraz je kladeny na to, at se vi, jak jsou tam ulozeny adresare a soubory. Pak prislo par otazek typu, jake jsou omezeni FATky, (velikost souboru, partitiony, ale hlavne se po me chtelo slyset: prava), kde se s tim dnes setkame (flashky, pametove karty) - na ty jsem dosel po vyjmenovani win98, mobilu, zkusil jsem i routery a ind. pocitace a nakonec me uspesne dovedl ke spravne odpovedi U ext2 prislo, proc se to porad jeste pouziva,kdyz je to tak stary FS - jedine co me napadlo byla rychlost - spravne
\end{reportN}
